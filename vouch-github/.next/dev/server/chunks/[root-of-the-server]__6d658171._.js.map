{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///Users/pablo/The-Ghost-Operator/vouch-github/app/api/web-proof/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport fs from 'fs';\nimport path from 'path';\n\n// Simple file-based storage (replace with database in production)\nconst PROOFS_FILE = path.join(process.cwd(), 'proofs.json');\n\ninterface WebProof {\n  proofId: string;\n  requestId?: string;\n  payload: any;\n  verified: boolean;\n  action?: 'pull_request' | 'merge';\n  createdAt: string;\n}\n\nfunction getProofs(): WebProof[] {\n  try {\n    if (fs.existsSync(PROOFS_FILE)) {\n      const data = fs.readFileSync(PROOFS_FILE, 'utf-8');\n      return JSON.parse(data);\n    }\n  } catch (error) {\n    console.error('Error reading proofs:', error);\n  }\n  return [];\n}\n\nfunction saveProof(proof: WebProof) {\n  try {\n    const proofs = getProofs();\n    const existingIndex = proofs.findIndex(p => p.proofId === proof.proofId);\n    \n    if (existingIndex >= 0) {\n      proofs[existingIndex] = proof;\n    } else {\n      proofs.push(proof);\n    }\n    \n    fs.writeFileSync(PROOFS_FILE, JSON.stringify(proofs, null, 2));\n  } catch (error) {\n    console.error('Error saving proof:', error);\n  }\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const payload = await request.json();\n    \n    console.log('Received webhook payload:', JSON.stringify(payload, null, 2));\n    \n    // Extract requestId from payload\n    const requestId = payload.requestId || payload.request_id || null;\n    const proofId = payload.proofId || payload.proof_id || `proof-${Date.now()}`;\n    \n    // Determine action type from payload\n    let action: 'pull_request' | 'merge' | undefined;\n    if (payload.inputs) {\n      if (payload.inputs.action === 'merge' || payload.inputs.pr_number) {\n        action = payload.inputs.action === 'merge' ? 'merge' : 'pull_request';\n      }\n    }\n    \n    // Store the proof\n    const proof: WebProof = {\n      proofId,\n      requestId,\n      payload,\n      verified: true, // vouch proofs are pre-verified\n      action,\n      createdAt: new Date().toISOString(),\n    };\n    \n    saveProof(proof);\n    \n    console.log(`âœ… Proof stored: ${proofId} (requestId: ${requestId})`);\n    \n    return NextResponse.json({ success: true, proofId }, { status: 200 });\n  } catch (error) {\n    console.error('Error storing web proof:', error);\n    return NextResponse.json(\n      { error: 'Failed to store web proof' },\n      { status: 500 }\n    );\n  }\n}\n\n// GET endpoint to retrieve proof by requestId\nexport async function GET(request: NextRequest) {\n  try {\n    const { searchParams } = new URL(request.url);\n    const requestId = searchParams.get('requestId');\n    \n    if (!requestId) {\n      return NextResponse.json(\n        { error: 'requestId is required' },\n        { status: 400 }\n      );\n    }\n    \n    const proofs = getProofs();\n    const proof = proofs.find(p => p.requestId === requestId);\n    \n    if (!proof) {\n      return NextResponse.json(proof, { status: 200 });\n    }\n    \n    return NextResponse.json(\n      { error: 'Proof not found' },\n      { status: 404 }\n    );\n  } catch (error) {\n    console.error('Error retrieving proof:', error);\n    return NextResponse.json(\n      { error: 'Failed to retrieve proof' },\n      { status: 500 }\n    );\n  }\n}\n\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;;;;AAEA,kEAAkE;AAClE,MAAM,cAAc,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI;AAW7C,SAAS;IACP,IAAI;QACF,IAAI,wGAAE,CAAC,UAAU,CAAC,cAAc;YAC9B,MAAM,OAAO,wGAAE,CAAC,YAAY,CAAC,aAAa;YAC1C,OAAO,KAAK,KAAK,CAAC;QACpB;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yBAAyB;IACzC;IACA,OAAO,EAAE;AACX;AAEA,SAAS,UAAU,KAAe;IAChC,IAAI;QACF,MAAM,SAAS;QACf,MAAM,gBAAgB,OAAO,SAAS,CAAC,CAAA,IAAK,EAAE,OAAO,KAAK,MAAM,OAAO;QAEvE,IAAI,iBAAiB,GAAG;YACtB,MAAM,CAAC,cAAc,GAAG;QAC1B,OAAO;YACL,OAAO,IAAI,CAAC;QACd;QAEA,wGAAE,CAAC,aAAa,CAAC,aAAa,KAAK,SAAS,CAAC,QAAQ,MAAM;IAC7D,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,uBAAuB;IACvC;AACF;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,UAAU,MAAM,QAAQ,IAAI;QAElC,QAAQ,GAAG,CAAC,6BAA6B,KAAK,SAAS,CAAC,SAAS,MAAM;QAEvE,iCAAiC;QACjC,MAAM,YAAY,QAAQ,SAAS,IAAI,QAAQ,UAAU,IAAI;QAC7D,MAAM,UAAU,QAAQ,OAAO,IAAI,QAAQ,QAAQ,IAAI,CAAC,MAAM,EAAE,KAAK,GAAG,IAAI;QAE5E,qCAAqC;QACrC,IAAI;QACJ,IAAI,QAAQ,MAAM,EAAE;YAClB,IAAI,QAAQ,MAAM,CAAC,MAAM,KAAK,WAAW,QAAQ,MAAM,CAAC,SAAS,EAAE;gBACjE,SAAS,QAAQ,MAAM,CAAC,MAAM,KAAK,UAAU,UAAU;YACzD;QACF;QAEA,kBAAkB;QAClB,MAAM,QAAkB;YACtB;YACA;YACA;YACA,UAAU;YACV;YACA,WAAW,IAAI,OAAO,WAAW;QACnC;QAEA,UAAU;QAEV,QAAQ,GAAG,CAAC,CAAC,gBAAgB,EAAE,QAAQ,aAAa,EAAE,UAAU,CAAC,CAAC;QAElE,OAAO,+LAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAM;QAAQ,GAAG;YAAE,QAAQ;QAAI;IACrE,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,4BAA4B;QAC1C,OAAO,+LAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAA4B,GACrC;YAAE,QAAQ;QAAI;IAElB;AACF;AAGO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAC5C,MAAM,YAAY,aAAa,GAAG,CAAC;QAEnC,IAAI,CAAC,WAAW;YACd,OAAO,+LAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAwB,GACjC;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,SAAS;QACf,MAAM,QAAQ,OAAO,IAAI,CAAC,CAAA,IAAK,EAAE,SAAS,KAAK;QAE/C,IAAI,CAAC,OAAO;YACV,OAAO,+LAAY,CAAC,IAAI,CAAC,OAAO;gBAAE,QAAQ;YAAI;QAChD;QAEA,OAAO,+LAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAkB,GAC3B;YAAE,QAAQ;QAAI;IAElB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,2BAA2B;QACzC,OAAO,+LAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAA2B,GACpC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}